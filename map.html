<!DOCTYPE html>
<meta charset="utf-8">
<style>
path {
  fill:#ccc;
  stroke:#000
}
.census-centr {
  fill:red;
}
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>

var width = 960,
    height = 1160;

var svg = d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height);
var test;
d3.json("nyccensus.json", function(error, nyc) {
	if (error) {return console.error(error)}
	var subunits = topojson.feature(nyc, nyc.objects.census)

  test = subunits;

  //
	var projection = d3.geo.mercator()
    .center([-73.94, 40.70])
    .scale(60000)
		.translate([width / 2, height / 2])
  //
	var path = d3.geo.path()
		.projection(projection);
  //

  features = subunits.features

  features.forEach(function(feature, i) {
    feature.centroid = path.centroid(feature);
    if (feature.centroid.some(isNaN)) feature.centroid = null; // off the map
  });

  svg.selectAll('tract')
      .data(features)
      .enter()
      .append("path")
      .attr('class','path')
      .attr("d", path)
      .on("click", function(d){
        console.log(projection.invert(d.centroid))
      });

  svg.selectAll('census-centr')
    .data(features)
    .enter()
    .append('circle')
    .attr('class','census-centr')
    .attr('transform',function(d){
      return 'translate (' + d.centroid[0] + ',' +d.centroid[1] + ')'
    })
    .attr('r',2)
})
</script>
